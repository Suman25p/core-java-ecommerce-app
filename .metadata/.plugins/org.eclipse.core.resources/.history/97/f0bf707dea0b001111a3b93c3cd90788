package com.ecommerce.service;

import java.util.Map;

import com.ecommerce.exception.OutOfStockException;
import com.ecommerce.exception.ProductNotAvailableException;
import com.ecommerce.model.Products;

public class CheckoutProcess {
	
	ProductManagement productManagement = new ProductManagement();
	CartManagement cartManagement = new CartManagement();
	
	public void checkOut(Map<Products,Integer> cart) throws OutOfStockException
	{
		try {
		if(cart.isEmpty()) {
			throw new ProductNotAvailableException("Cart is empty, choose your product");
		}
		
		for(Map.Entry<Products, Integer> entry: cart.entrySet()) {
			Products product = entry.getKey();
			int quantity = entry.getValue();
			
			if( quantity > product.getStock() ) {
				throw new OutOfStockException(product.getName() + " is out of stock");
			}
		}
		
		double totalPrice = 0;
		
		System.out.println("-------Final Bill-------");
		
		for(Map.Entry<Products, Integer> entry : cart.entrySet()) {
			Products product = entry.getKey();
			int quantity = entry.getValue();
			
			double subTotal = product.getPrice() * quantity;
			
			totalPrice = totalPrice + subTotal;
			
			System.out.println(product.getName() + ",  Qty: " + quantity + " , SubTotal: Rs. " + subTotal);
		}
		
		System.out.println("======================");
		System.out.println("Total Amount: Rs." + totalPrice);
		
		cartManagement.reduceStock();
		
		cart.clear();
		
		System.out.println("Checkout successful!");
		
	}
}
